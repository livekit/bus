// Code generated by protoc-gen-psrpc v0.2.0, DO NOT EDIT.
// source: importable.proto

// Test to make sure that importing other packages doesnt break

package importable

import context "context"

import psrpc "github.com/livekit/psrpc"

// ====================
// Svc Client Interface
// ====================

type SvcClient interface {
	Send(context.Context, *Msg, ...psrpc.RequestOption) (*Msg, error)
}

// ========================
// Svc ServerImpl Interface
// ========================

type SvcServerImpl interface {
	Send(context.Context, *Msg) (*Msg, error)
}

// ====================
// Svc Server Interface
// ====================

type SvcServer interface {
	// Close and wait for pending RPCs to complete
	Shutdown()

	// Close immediately, without waiting for pending RPCs
	Kill()
}

// ==========
// Svc Client
// ==========

type svcClient struct {
	client *psrpc.RPCClient
}

// NewSvcClient creates a psrpc client that implements the SvcClient interface.
func NewSvcClient(clientID string, bus psrpc.MessageBus, opts ...psrpc.ClientOption) (SvcClient, error) {
	rpcClient, err := psrpc.NewRPCClient("Svc", clientID, bus, opts...)
	if err != nil {
		return nil, err
	}

	return &svcClient{
		client: rpcClient,
	}, nil
}

func (c *svcClient) Send(ctx context.Context, req *Msg, opts ...psrpc.RequestOption) (*Msg, error) {
	return psrpc.RequestSingle[*Msg](ctx, c.client, "Send", "", req, opts...)
}

// ==========
// Svc Server
// ==========

type svcServer struct {
	svc SvcServerImpl
	rpc *psrpc.RPCServer
}

// NewSvcServer builds a RPCServer that will route requests
// to the corresponding method in the provided svc implementation.
func NewSvcServer(serverID string, svc SvcServerImpl, bus psrpc.MessageBus, opts ...psrpc.ServerOption) (SvcServer, error) {
	s := psrpc.NewRPCServer("Svc", serverID, bus, opts...)

	var err error
	err = psrpc.RegisterHandler(s, "Send", "", svc.Send, nil)
	if err != nil {
		s.Close(false)
		return nil, err
	}

	return &svcServer{
		svc: svc,
		rpc: s,
	}, nil
}

func (s *svcServer) Shutdown() {
	s.rpc.Close(false)
}

func (s *svcServer) Kill() {
	s.rpc.Close(true)
}

var psrpcFileDescriptor0 = []byte{
	// 140 bytes of a gzipped FileDescriptorProto
	0x1f, 0x8b, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0xff, 0xe2, 0x12, 0xc8, 0xcc, 0x2d, 0xc8,
	0x2f, 0x2a, 0x49, 0x4c, 0xca, 0x49, 0xd5, 0x2b, 0x28, 0xca, 0x2f, 0xc9, 0x17, 0x92, 0x2b, 0x28,
	0x2e, 0x2a, 0x48, 0xd6, 0xcb, 0xcc, 0x2b, 0x49, 0x2d, 0xca, 0x4b, 0xcc, 0xd1, 0x2b, 0x49, 0x2d,
	0x2e, 0xd1, 0x43, 0xa8, 0x52, 0x62, 0xe5, 0x62, 0xf6, 0x2d, 0x4e, 0x37, 0x0a, 0xe7, 0x62, 0x0e,
	0x2e, 0x4b, 0x16, 0x0a, 0xe0, 0x62, 0x09, 0x4e, 0xcd, 0x4b, 0x11, 0x52, 0xd6, 0xc3, 0xaf, 0x4d,
	0xcf, 0xb7, 0x38, 0x5d, 0x8a, 0x18, 0x45, 0x4e, 0xc6, 0x51, 0x86, 0xe9, 0x99, 0x25, 0x19, 0xa5,
	0x49, 0x7a, 0xc9, 0xf9, 0xb9, 0xfa, 0x39, 0x99, 0x65, 0xa9, 0xd9, 0x99, 0x25, 0xfa, 0x60, 0x8d,
	0xfa, 0x30, 0x8d, 0xfa, 0x20, 0x8d, 0xfa, 0x08, 0x8d, 0x49, 0x6c, 0x60, 0xb7, 0x1b, 0x03, 0x02,
	0x00, 0x00, 0xff, 0xff, 0xb6, 0xdf, 0xe8, 0x19, 0xcf, 0x00, 0x00, 0x00,
}
